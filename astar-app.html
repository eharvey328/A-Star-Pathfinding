<link rel="import" href="bower_components/polymer/polymer.html">
<link rel="import" href="bower_components/app-layout/app-layout.html">
<link rel="import" href="bower_components/paper-menu/paper-menu.html">
<link rel="import" href="bower_components/paper-item/paper-icon-item.html">
<link rel="import" href="bower_components/iron-icon/iron-icon.html">
<link rel="import" href="bower_components/iron-icons/iron-icons.html">
<link rel="import" href="bower_components/paper-slider/paper-slider.html">
<link rel="import" href="bower_components/paper-button/paper-button.html">
<link rel="import" href="bower_components/paper-toggle-button/paper-toggle-button.html">

<dom-module id="astar-app">
  <style>
    .horizontal {
      @apply(--layout-horizontal);
    }

    .vertical {
      @apply(--layout-vertical);
    }

    .center {
      @apply(--layout-center);
    }

    .justified {
      @apply(--layout-justified);
    }

    .center-justified {
      @apply(--layout-center-justified);
    }

    .center-center {
      @apply(--layout-center-center);
    }

    #nav-top {
      color: white;
      background: #000;
      height: 256px;  
      padding: 16px;
    }

    #nav-title {
      font-family: 'Roboto Mono';
      font-size:  28px;
      opacity: .8;
    }

    #nav-names {
      font-size: 14px;
      opacity: .54;
    }

    app-drawer {
      --app-drawer-content-container: {
        background-color: #212121;
      }
    }

    paper-menu {
      padding-top: 0;
      --paper-menu-background-color: #212121;
      --paper-menu-color: rgba(255,255,255,0.8);
      --paper-menu-selected-item: {
        font-weight: normal;
        background-color: #303030;
      }
      --paper-menu-focused-item: {
        background-color: #303030;
      }

      --paper-menu-focused-item-after: {
        background-color: transparent;
      }
    }

    paper-icon-item {
      font-family: 'Roboto Mono';
      min-height: 64px;
      --paper-item-selected: {
        background-color: #303030;
      }
      --paper-item-focused: {
        background-color: transparent;
      }

      --paper-item-focused-before: {
        background-color: transparent;
      }
    }

    #control-menu {
      width: 325px;
      padding: 0 16px;
      height: 100vh;
      float: left;
      border-right: 2px solid rgba(0,0,0,0.16);
      box-sizing: border-box;
    }

    #canvas-container {
      width: calc(100% - 325px);
      height: 100vh;
    }

    .container {
      padding: 40px 0;
      border-bottom: 2px solid rgba(0,0,0,0.16);
    }

    #coord-container {
      margin-top: -20px;
    }

    #btn-container {
      position: absolute;
      bottom: 0;
    }

    .slider-title {
      color: white;
      opacity: .8; 
    }

    #sizeslider {
      --paper-slider-knob-color: #00E676;
      --paper-slider-active-color: #00E676;
    }

    #densityslider {
      --paper-slider-knob-color: #ff1744;
      --paper-slider-active-color: #ff1744;
    }

    paper-slider {
      width: 100%;
      --paper-slider-input: {
        width: 75px;
      }
    }

    paper-button {
      margin-top: 18px;
      color: rgba(0,0,0,.8);
      font-weight: 500;
      font-family: "Roboto Mono";
    }

    #step-btn {
      background-color: #757575;
      width: 131px;
    }

    #reset-btn {
      background-color: #ff1744;
      width: 131px;
    } 

    #runbtn {
      background-color: #00C853;
      display: flex;
      -webkit-transition: background-color 300ms;
      transition: background-color 300ms;
    }

    #runbtn[active] {
      background-color: #FFEA00;
    }

    paper-toggle-button {
      font-family: "Roboto Mono";
      --paper-toggle-button-label-color: rgba(255,255,255,.8);
      --paper-toggle-button-unchecked-button-color: #424242;
      --paper-toggle-button-checked-bar-color: #2979FF;
      --paper-toggle-button-checked-button-color: #2979FF;
      --paper-toggle-button-checked-ink-color: #2979FF;
      --paper-toggle-button-label-spacing: 12px;
    }

    #diagToggle {
      margin-bottom: 28px;
    }

    .coord-input {
      width: 40px;
      display: inline-block;
      --paper-input-container-focus-color: rgba(255,255,255,.8);
      --paper-input-container-input-color: rgba(255,255,255,.8);
      --paper-input-container: {
        padding: 0;
      }
      --paper-input-container-input: {
        padding-left: 12px;
      }
    }

    .coord-title {
      color: rgba(255,255,255,.8);
      margin-top: 20px;
    }

    #start-coord {
      width: 100%;
    }

    #end-coord {
      width: 100%;
      margin-top: 20px;
    }


  </style>

  <template>
    <app-drawer-layout>
      <app-drawer>
        <div id="nav-top" class="vertical justified">
          <div id="nav-title">A Star Pathfinding</div>
          <div id="nav-names" class="vertical">
            <span>By:</span>
            <span>Eric Harvey &amp;</span>
            <span>Caleb Kupetz</span>
          </div>
        </div>

        <paper-menu id="menu" selected="walls" attr-for-selected="name" on-iron-select="_modeSelected">
          <paper-icon-item name="walls">
            <iron-icon icon="apps" item-icon></iron-icon>Walls
          </paper-icon-item>
          <paper-icon-item id="maze-toggle" name="maze">
            <iron-icon icon="subdirectory-arrow-right" item-icon></iron-icon>Maze
          </paper-icon-item>
        </paper-menu>
      </app-drawer>

      <div id="control-menu" class="vertical">

        <div id="coord-container" class="vertical container">

          <div id="start-coord" class="horizontal justified">
            <div class="coord-title">Start Index:</div>
            <div class="coord-wrapper" class="horizontal">
              <paper-input class="coord-input" id="startX" value="0" type="number" on-input="setCoord" auto-validate
              allowed-pattern="^\d*$"></paper-input>
              <paper-input class="coord-input" id="startY" value="0" type="number" on-input="setCoord" auto-validate
              allowed-pattern="^\d*$"></paper-input>
            </div>
          </div>

          <div class="horizontal justified" id="end-coord">
            <div class="coord-title">End Index:</div>
            <div class="coord-wrapper" class="horizontal">
              <paper-input class="coord-input" id="endX" value="29" type="number" on-input="setCoord"></paper-input>
              <paper-input class="coord-input" id="endY" value="29" type="number" on-input="setCoord"></paper-input>
            </div>
          </div>
        </div>

        <div id="slider-container" class="container">
          <div id="sstitle" class="slider-title">Size</div>
          <paper-slider id="sizeslider" value="30" max="100" min="10" editable on-change="_setSlider"></paper-slider>
          <div id="dstitle" class="slider-title">Density</div>
          <paper-slider id="densityslider" value="20" max="40" editable on-change="_setSlider"></paper-slider>
        </div>

        <div id="toggle-container" class="vertical container">
          <paper-toggle-button id="diagToggle" checked>Diagonal Traversal</paper-toggle-button>
          <paper-toggle-button id="cornerToggle">Through Corners</paper-toggle-button>
        </div>

        <div id="btn-container" class="container">  
          <paper-button raised id="step-btn" onclick="step();">Step</paper-button>
          <paper-button raised id="reset-btn" onclick="reset();">Reset</paper-button>
          <paper-button raised id="runbtn" onclick="runPause();" on-tap="_toggleText" toggles>Run</paper-button>
        </div>

      </div>

      <div id="canvas-container" class="vertical center-center">
        <div id="canvas-holder"></div>
      </div>

    </div>

  </app-drawer-layout>

</template>

<script>
  Polymer({
    is: 'astar-app',

    listeners: {
      'immediate-value-change': 'immediateValueChangeHandler',
    },

    ready: function () {
      this.$.diagToggle.addEventListener('change', function () {
        if (this.checked) {
          allowDiagonals = true;
        } else {
          allowDiagonals = false;
        }
      });

      this.$.cornerToggle.addEventListener('change', function () {
        if (this.checked) {
          canPassThroughCorners = true;
        } else {
          canPassThroughCorners = false;
        }
      });
    },

    setCoord : function() {
      var startXCoord = this.$.startX.value;
      var startYCoord = this.$.startY.value;
      var endXCoord = this.$.endX.value;
      var endYCoord = this.$.endY.value;
      getCoordValues(startXCoord, startYCoord, endXCoord, endYCoord);
    },

    _toggleText : function() {
      var button = this.$.runbtn;
      if(button.active) {
        button.textContent = 'Pause';
      } else {
        button.textContent = 'Run';
      }
    },

    _setSlider : function() {
      var sizeValue = this.$.sizeslider.value;
      var densityValue = this.$.densityslider.value;
      this.$.endX.value = sizeValue - 1;
      this.$.endY.value = sizeValue - 1;

      console.log(sizeValue);

      getSliderValues(sizeValue, densityValue);
    },

    immediateValueChangeHandler: function (e) {
      var sizeValue = this.$.sizeslider.immediateValue;
      var densityValue = this.$.densityslider.immediateValue;
      this.$.endX.value = sizeValue - 1;
      this.$.endY.value = sizeValue - 1;

      getSliderValues(sizeValue, densityValue);
    },

    _modeSelected : function(e) {
      var mode = e.target.selectedItem;
      var densityslider =  this.$$('#densityslider');
      var densityTitle = this.$$('#dstitle');

      if(mode) {
        if(mode.innerText == "Maze") {
          densityslider.style.display = "none";
          densityTitle.style.display = "none";
        } else {
         densityslider.style.display = "flex";
         densityTitle.style.display = "block";
       }
     }
     reset();
   }
 });

</script>
</dom-module>
